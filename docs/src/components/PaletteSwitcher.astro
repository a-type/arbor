---
const { class: cs } = Astro.props;
---

<palette-switcher class:list={['block text-size-md', cs]}></palette-switcher>
<script type="module">
	class PaletteSwitcher extends HTMLElement {
		constructor() {
			super();
			this.group = document.createElement('div');
			this.group.className = 'flex gap-lg justify-center p-xs group';
			this.group.addEventListener('change', this.onChange.bind(this));
			this.appendChild(this.group);
			this.populateOptions();

			// detect from date
			const month = new Date().getMonth();
			let defaultPalette = 'winter';
			if (month >= 2 && month <= 4) {
				defaultPalette = 'spring';
			} else if (month >= 5 && month <= 7) {
				defaultPalette = 'summer';
			} else if (month >= 8 && month <= 10) {
				defaultPalette = 'fall';
			}
			this.select.value = defaultPalette;
			this.apply(defaultPalette);
		}

		populateOptions() {
			const palettes = ['winter', 'spring', 'summer', 'fall'];
			const icons = {
				winter: 'â„ï¸',
				spring: 'ðŸŒ¸',
				summer: 'â˜€ï¸',
				fall: 'ðŸ‚',
			};
			palettes.forEach((palette) => {
				const input = document.createElement('input');
				input.type = 'radio';
				input.name = 'palette';
				input.value = palette;
				input.className = 'appearance-none m-0 absolute -inset-9999';
				input.textContent = palette;
				const option = document.createElement('label');
				option.classList.add(
					'flex',
					'items-center',
					'justify-center',
					'gap-sm',
					'overflow-clip',
					'relative',
					'p-sm',
					'rd',
					'cursor-pointer',
					'bg-main-wash',
					'hover:bg-darken-1',
					'active:bg-darken-2',
					`palette-${palette}`,
				);
				option.appendChild(input);
				const label = document.createElement('span');
				label.classList.add('aspect-1', 'text-size-inherit');
				label.innerHTML = icons[palette];
				label.attributes['aria-label'] = `Select ${palette} palette`;
				option.appendChild(label);
				this.group.appendChild(option);
			});
		}

		onChange(event) {
			const selectedPalette = event.target.value;
			this.apply(selectedPalette);
		}

		apply(selectedPalette) {
			document.body.classList.remove(
				'palette-winter',
				'palette-spring',
				'palette-summer',
				'palette-fall',
			);
			document.body.classList.add(`palette-${selectedPalette}`);
		}
	}

	customElements.define('palette-switcher', PaletteSwitcher);
</script>
