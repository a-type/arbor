---
const { class: cs } = Astro.props;
---

<hue-picker class={cs}></hue-picker>
<script type="module">
	class HuePicker extends HTMLElement {
		constructor() {
			super();
			this.input = document.createElement('input');
			this.input.type = 'color';
			this.input.className =
				'w-100% h-40px appearance-none b-0 p-0 rd bg-transparent cursor-pointer';
			this.input.addEventListener('input', this.onInput.bind(this));
			this.appendChild(this.input);
		}

		onInput(event) {
			const color = event.target.value;
			console.log(color);
			this.apply(color);
		}
		apply(color) {
			const hue = this.hexToHue(color);
			// TODO: adjust for oklch

			document.documentElement.style.setProperty('--u-c-primary-hue', hue);
		}
		hexToHue(hex) {
			// Convert hex to RGB
			const r = parseInt(hex.slice(1, 3), 16) / 255;
			const g = parseInt(hex.slice(3, 5), 16) / 255;
			const b = parseInt(hex.slice(5, 7), 16) / 255;

			// Find max and min RGB values
			const max = Math.max(r, g, b);
			const min = Math.min(r, g, b);
			let h;

			if (max === min) {
				h = 0; // achromatic
			} else if (max === r) {
				h = (60 * ((g - b) / (max - min)) + 360) % 360;
			} else if (max === g) {
				h = (60 * ((b - r) / (max - min)) + 120) % 360;
			} else {
				h = (60 * ((r - g) / (max - min)) + 240) % 360;
			}

			return h;
		}
	}
	customElements.define('hue-picker', HuePicker);
</script>
